<?xml version="1.0" encoding="UTF-8"?>
<update xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://www.ofw.fi/xml/2011/java-xmldb-updater/UpdaterSchema.xsd">

  <sql>alter table Material drop foreign key FK_ni0oofdm6ctau494pkufung9o;</sql>
  <sql>alter table Material drop column originMaterial_id;</sql>
  
  <sql>create table OrphanMaterial (id bigint not null, primary key (id));</sql>
  <sql>insert into OrphanMaterial (select id from Material where id not in (select materialId from WorkspaceMaterial));</sql>
  
  <sql>insert into SystemSetting (settingKey, settingValue) values ('materials.orphanRemoval', '1');</sql>

</update>