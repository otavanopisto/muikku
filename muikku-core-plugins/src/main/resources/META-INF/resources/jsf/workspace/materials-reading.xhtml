<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml" 
  xmlns:c="http://java.sun.com/jsp/jstl/core" 
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:f="http://java.sun.com/jsf/core" 
  xmlns:h="http://java.sun.com/jsf/html" 
  xmlns:m="http://www.ofw.fi/xml/2013/muikku/components-taglib.xsd"
  xmlns:composite="http://java.sun.com/jsf/composite/composite" 
  template="/jsf/workspace/templates/workspace-materials-reading-view.xhtml">
  
  <ui:define name="workspaces.materials.reading.toc">
    <form style="display: none;">
      <input type="hidden" name="max-file-size" value="#{workspaceMaterialsBackingBean.maxFileSize}" />
    </form>
  
    <div id="workspaceMaterialsReadingTOCWrapper">
      <nav class="workspace-waterials-reading-nav" id="workspaceMaterialsReadingNav">
        <m:widgetSpaceSet>
          <m:widgetSpace name="workspaces.materials.reading.dock" keepEmpty="true" sizing="MINIMIZE" styleClass="">
            <m:widget name="workspaces-materials-full-screen-toc" size="1" />
            <m:widget name="workspaces-materials-full-screen-goback" size="1" />
            <m:widget name="workspaces-materials-full-screen-manage-materials" size="1" rendered="#{sessionBackingBean.hasWorkspacePermission('MANAGE_WORKSPACE_MATERIALS')}"/>
          </m:widgetSpace>
        </m:widgetSpaceSet>
      </nav>
    
      <div id="workspaceMaterialsReadingTOCContainer">
        <div class="workspace-materials-reading-TOC-title">
          <h1>#{i18n.text['plugin.workspace.materialsReading.tocTitle']}</h1>
          <div id="workspaceMaterialsReadingTOCPinicon" class="icon-pin" title="Kiinnitä sisällysluettelo"></div>
        </div>
        <div class="workspace-materials-toc-content-scrolling" id="materialsScrollableTOC">
          <ul class="workspace-materials-toc-root">
            <ui:repeat var="node" value="#{workspaceMaterialsReadingBackingBean.contentNodes}">
              <ui:fragment rendered="#{node.type eq 'folder'}">
                <li>
                  <ul class="workspace-materials-toc-section">
                    <li class="workspace-materials-toc-subtitle">#{node.title}</li>

                    <ui:repeat var="articleNode" value="#{node.children}">
                      <ui:fragment rendered="#{articleNode.type eq 'folder'}">
                        <li class="workspace-materials-toc-subtitle">#{articleNode.title}</li>
                      </ui:fragment>
                      <ui:fragment rendered="#{articleNode.type ne 'folder'}">
                        <li class="workspace-materials-toc-item" data-workspace-material-id="#{articleNode.workspaceMaterialId}">
                          <h:outputLink value="#page-#{articleNode.workspaceMaterialId}" class="#{articleNode.assignmentType eq 'EVALUATED' ? 'assignment' : articleNode.assignmentType eq 'EXERCISE' ? 'exercise' : ''}">#{articleNode.title}</h:outputLink>
                        </li>
                      </ui:fragment>
                    </ui:repeat>
                  </ul>
                </li>
              </ui:fragment>

              <ui:fragment rendered="#{node.type ne 'folder'}">
                <li class="workspace-materials-toc-item" data-workspace-material-id="#{articleNode.workspaceMaterialId}">
                  <h:outputLink value="#page-#{node.workspaceMaterialId}" class="#{node.assignmentType eq 'EVALUATED' ? 'assignment' : node.assignmentType eq 'EXERCISE' ? 'exercise' : ''}">#{node.title}</h:outputLink>
                </li>
              </ui:fragment>
            </ui:repeat>
          </ul>
        </div>
      </div>
    </div>
  </ui:define>

  <ui:define name="workspace.materials.reading.content">
    <article>
      <h1>#{workspaceMaterialsReadingBackingBean.workspaceName}</h1>
      <ui:repeat var="node" value="#{workspaceMaterialsReadingBackingBean.contentNodes}">
        <ui:fragment rendered="#{node.type eq 'folder'}">
          <section id="page-#{node.workspaceMaterialId}" class="workspace-materials-view-page-section material-reading-view" data-workspace-material-id="#{node.workspaceMaterialId}" data-material-id="#{node.materialId}" data-material-type="#{node.type}" data-material-title="#{node.title}" data-path="#{node.path}">
            <h2>#{node.title}</h2>
            
            <ui:repeat var="articleNode" value="#{node.children}">
              <ui:fragment rendered="#{articleNode.type eq 'folder'}">
                <ui:fragment rendered="#{articleNode.level eq 1}">
                  <h3>#{articleNode.title}</h3>
                </ui:fragment>
                <ui:fragment rendered="#{articleNode.level eq 2}">
                  <h4>#{articleNode.title}</h4>
                </ui:fragment>
                <ui:fragment rendered="#{articleNode.level eq 3}">
                  <h5>#{articleNode.title}</h5>
                </ui:fragment>
                <ui:fragment rendered="#{(articleNode.level eq 4) or (articleNode.level gt 4)}">
                  <h6>#{articleNode.title}</h6>
                </ui:fragment>
              </ui:fragment>
              <ui:fragment rendered="#{articleNode.type ne 'folder'}">
                <article id="page-#{articleNode.workspaceMaterialId}" data-correct-answers="#{articleNode.correctAnswers}" data-assignment-type="#{articleNode.assignmentType}" data-workspace-material-id="#{articleNode.workspaceMaterialId}" data-material-id="#{articleNode.materialId}" data-material-type="#{articleNode.type}" data-material-title="#{articleNode.title}" data-material-content="#{articleNode.html}" data-path="#{articleNode.path}" data-license="#{articleNode.license}" data-producers="#{articleNode.producers}" class="workspace-materials-view-page material-reading-view"/>
              </ui:fragment>
            </ui:repeat>
          </section>
        </ui:fragment>  
        
        <ui:fragment rendered="#{node.type ne 'folder'}">
          <article id="page-#{node.workspaceMaterialId}" data-correct-answers="#{node.correctAnswers}" data-assignment-type="#{node.assignmentType}" data-workspace-material-id="#{node.workspaceMaterialId}" data-material-id="#{node.materialId}" data-material-type="#{node.type}" data-material-title="#{node.title}" data-material-content="#{node.html}" data-path="#{node.path}" data-license="#{node.license}" data-producers="#{node.producers}" class="workspace-materials-view-page material-reading-view"/>
        </ui:fragment>  
      </ui:repeat>
    </article>
    
    <input class="workspaceEntityId" type="hidden" value="#{workspaceMaterialsReadingBackingBean.workspaceEntityId}"/>
    <input class="materialsBaseUrl" type="hidden" value="#{workspaceMaterialsReadingBackingBean.materialsBaseUrl}"/>
  </ui:define>
  
  <ui:define name="workspaces.materials.reading.additional.dock">
    <div id="workspaceMaterialsReadingAdditionalNavWrapper">
      <nav class="workspace-waterials-reading-additional-nav">
        <m:widgetSpaceSet>
          <m:widgetSpace name="workspaces.materials.reading.dock" keepEmpty="true" sizing="MINIMIZE" styleClass="">
            <m:widget name="workspaces-materials-reading-goback" size="1" />
            <m:widget name="workspaces-materials-reading-manage-materials" size="1" />
          </m:widgetSpace>
        </m:widgetSpaceSet>
      </nav>
    </div>
  </ui:define>

</ui:composition>
